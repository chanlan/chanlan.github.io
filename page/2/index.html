<!doctype html>



  


<html class="theme-next muse use-motion" lang="en">
<head>
  <meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1"/>



<meta http-equiv="Cache-Control" content="no-transform" />
<meta http-equiv="Cache-Control" content="no-siteapp" />












  
  
  <link href="/lib/fancybox/source/jquery.fancybox.css?v=2.1.5" rel="stylesheet" type="text/css" />




  
  
  
  

  
    
    
  

  

  

  

  

  
    
    
    <link href="//fonts.googleapis.com/css?family=Lato:300,300italic,400,400italic,700,700italic&subset=latin,latin-ext" rel="stylesheet" type="text/css">
  






<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css" />

<link href="/css/main.css?v=5.1.0" rel="stylesheet" type="text/css" />


  <meta name="keywords" content="Hexo, NexT" />








  <link rel="shortcut icon" type="image/x-icon" href="/favicon.ico?v=5.1.0" />






<meta name="description" content="代码也是有灵魂的">
<meta property="og:type" content="website">
<meta property="og:title" content="Learn And Life.">
<meta property="og:url" content="http://chanlan.github.io/page/2/index.html">
<meta property="og:site_name" content="Learn And Life.">
<meta property="og:description" content="代码也是有灵魂的">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Learn And Life.">
<meta name="twitter:description" content="代码也是有灵魂的">



<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Muse',
    sidebar: {"position":"left","display":"post"},
    fancybox: true,
    motion: true,
    duoshuo: {
      userId: '0',
      author: 'Author'
    },
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>



  <link rel="canonical" href="http://chanlan.github.io/page/2/"/>





  <title> Learn And Life. </title>
</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  










  
  
    
  

  <div class="container one-collumn sidebar-position-left 
   page-home 
 ">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-meta ">
  

  <div class="custom-logo-site-title">
    <a href="/"  class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <span class="site-title">Learn And Life.</span>
      <span class="logo-line-after"><i></i></span>
    </a>
  </div>
  <p class="site-subtitle">Focus on php and open source.</p>
</div>

<div class="site-nav-toggle">
  <button>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
    <span class="btn-bar"></span>
  </button>
</div>

<nav class="site-nav">
  

  
    <ul id="menu" class="menu">
      
        
        <li class="menu-item menu-item-home">
          <a href="/" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-home"></i> <br />
            
            Home
          </a>
        </li>
      
        
        <li class="menu-item menu-item-archives">
          <a href="/archives" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-archive"></i> <br />
            
            Archives
          </a>
        </li>
      
        
        <li class="menu-item menu-item-tags">
          <a href="/tags" rel="section">
            
              <i class="menu-item-icon fa fa-fw fa-tags"></i> <br />
            
            Tags
          </a>
        </li>
      

      
    </ul>
  

  
</nav>



 </div>
    </header>

    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chanlan.github.io/2016/12/22/关于线上问题/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kivmi">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Learn And Life.">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Learn And Life." src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/22/关于线上问题/" itemprop="url">
                  关于线上问题
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-22T10:01:43+08:00">
                2016-12-22
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>关于线上问题，是真正能够让我们成长的最好的方式，所以需要不断的积累，特别是大数据量时引起的一系列问题，包括人为的和线上的：</p>
<p>1.个人行为造成的问题，某同学想修改下数据表字段的类型，修改了一个几百万数据量的表，修改过程中会导致SQL阻塞，进一步导致请求阻塞，以至于整个系统请求平均延迟上升，产生了蝴蝶效应。如果量级更大的话，影响时间会更长，以至于整个系统不可用<br>总结：<br>线上的大表，因为都是基于innodb存储引起，修改引起的代价是比较大的，可能会锁表，索引尽可能的少执行这种操作，需要做好测试评估好执行影响时间</p>
<p>2.应用场景引发的问题，对于直播产品，视频直播结束，会向观众发送直播已经结束的消息，而这种消息是同时发送的，这样就会引起大量的数据产生和消费，造成的影响是，服务器消息堆积，客户端不知道直播是否结束，客户端仍然还在聊天室<br>总结：<br>在一定的时间内，比如1min, 离散的发送消息，让客户端能够在有限的时间内退出聊天室，不至于影响产品的用户体验</p>
<p>3.redis错误，read error on connection<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">PHP Fatal error:  Uncaught exception &apos;RedisException&apos; with message &apos;read error on connection&apos; in ....</div></pre></td></tr></table></figure></p>
<p>这个错误是偶尔遇到，有同学通过修改php soctet超时时间来修复该问题<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">default_socket_timeout = 60</div></pre></td></tr></table></figure></p>
<p>或者在脚本中添加<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">ini_set(&apos;default_socket_timeout&apos;, -1);  //不超时</div></pre></td></tr></table></figure></p>
<p>来解决该问题,但是这种解决方式并不是最好，而且这种方式需要重启php-fpm进程才可以生效</p>
<p>4.服务配置引起的问题，新开一个elb,支持cloudfront CDN支持，针对某个地区，将xxx.xxx.net这个域名，解析到cloudfront地址上，经由cloudfront再到后端elb进行访问，出现服务访问不了的情况，经运维协查，是cloude front服务配置问题导致<br>总结：<br>线上配置，需要谨慎修改，支持各种环境（线上，开发，测试，联调）发布部署配置文件的管理</p>
<p>5.设计问题，redis大key如何解，有时候对于好友关系等出现长尾数据的时候，存和读都会遇到问题，一般对大key的读，使用分页读，如果存储的数据量过大，1000w,那么做数据迁移还是数据恢复就会有问题，所以，单key的数据量的存储，不应过大<br>总结：<br>大key,可以使用应用层对id进行hash，生成统一前缀的key，自动实现key的查找</p>
<p>6.高并发，大数据引起最初设计的变化的问题，随着用户量的增加，uv上升，导致之前的设计请求量增加，系统压力增大，这样需要在原先的设计上，增加一些策略，当然，这种策略的增加需要产品的支持，比如消息发送，对任何用户等级之间的用户发送私信，当大网红直播时，这样导致消息量剧增，如果同时直播数比较多，产生的消息量会非常大，这样，可以增加一些策略来减少这种压力，比如只有达到某个等级的用户，在直播的时候，才对其粉丝发送私信，这样就大大的减少了消息量的产生，当然也可以在技术上支持</p>
<p>7.减少存储系统的压力，对于给予协助处理服务程序的数据，比如算法，这种服务的特性是非实时的，或者接近实时，对于这种数据的存储，不需要放到内存中存储，可以使用kafka来存储，将算法服务接入该系统，获取数据，并将数据的结果写入前端服务器或者内存中，供前端服务使用</p>
<p>8.线上日志，一种为数据日志，提供分析平台使用，而另外一种属于业务日志，供问题定位，对于业务日志，需要做到能准确定位所发生的问题，用户线上问题排查</p>
<p>9.无状态设计和有状态设计，无状态设计，比如静态文件，或者使用已有的信息，能拿到所需要的静态资源数据信息，怎样区权衡是使用有状态设计，还是使用无状态设计，还是有无状态设计相结合，需要考虑到对系统性能的影响，有多大的影响，增加有状态设计会产生什么多大的存储资源的损耗？是否是热点数据，是否需要将数据分多次多状态存储和维护？如果数据量不大，而且是基于热点，那么最好还是使用有状态设计，不会产生太多的资源损耗问题，性能还是实现的逻辑也是可以控制的</p>
<p>10.系统架构设计，使用ha来实现各节点之间活跃监控，增强系统的容错处理和可靠性</p>
<p>11.redis并发症控制，可以使用setnx来替换set</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chanlan.github.io/2016/12/20/go基础/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kivmi">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Learn And Life.">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Learn And Life." src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/20/go基础/" itemprop="url">
                  go基础
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-20T13:14:35+08:00">
                2016-12-20
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            
          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chanlan.github.io/2016/12/11/linux的10个命令/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kivmi">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Learn And Life.">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Learn And Life." src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/11/linux的10个命令/" itemprop="url">
                  linux的10个命令
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-11T00:20:53+08:00">
                2016-12-11
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先看下这个10个命令：<br>uptime<br>dmesg | tail<br>vmstat 1<br>mpstat -P ALL 1<br>pidstat 1<br>iostat -xz 1<br>free -m<br>sar -n DEV 1<br>sar -n TCP,ETCP 1<br>top</p>
<p>下面讲解下这个10个命令都是用来做什么的，怎么用</p>
<p>uptime</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">chenjingxiu:~ kivmi$ uptime</div><div class="line">00:23上午  up 6 days  1:53,  3 users,  load average: 1.96, 1.70, 1.70</div></pre></td></tr></table></figure>
<p>uptime – show how long system has been running<br>DESCRIPTION<br>     The uptime utility displays the current time, the length of time the system has been up, the number of users, and the load average of the system over the<br>          last 1, 5, and 15 minutes.<br>该命令用来查看系统的运行时间和负载情况，分别对应以下列<br>当前时间  启动运行时间 系统启动时间  当前系统用户数   系统最近1分钟、5分钟、15分钟系统的负载情况</p>
<p>dmesg | tail<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">chenjingxiu:~ kivmi$ sudo  dmesg | tail</div><div class="line">ARPT: 243830.149501: DequeueTime: 0x1906f048 LastTxTime: 0x1ff947d1 PHYTxErr:   0x0000 RxAckRSSI: 0x0000 RxAckSQ: 0x0000</div><div class="line">ARPT: 243830.149527: Raw[0]    1 Valid</div><div class="line">ARPT: 243830.149536: [2]    0 IM</div><div class="line">ARPT: 243830.149541: [3]    1 PM</div><div class="line">ARPT: 243830.149545: [7-4]  0 Suppr</div><div class="line">ARPT: 243830.149550: [14:8] 1 Ncons</div><div class="line">ARPT: 243830.149555: [15]   0 Acked</div><div class="line">ARPT: 243830.149561: txpktpend AC_BK 0 AC_BE 0 AC_VI 0 AC_VO 1 BCMC 0 ATIM 0</div><div class="line">SmartBattery: finished polling type 4</div><div class="line">UserEventAgent is not entitledUserEventAgent is not entitledloginwindow is not entitledloginwindow is not entitledUserEventAgent is not entitledUserEventAgent is not entitledloginwindow is not entitledloginwindow is not entitledUserEventAgent is not entitledUserEventAgent is not entitledloginwindow is not entitledloginwindow is not entitledSmartBattery: finished polling type 4</div></pre></td></tr></table></figure></p>
<p>dmesg – display the system message buffer<br>DESCRIPTION<br>     Dmesg displays the contents of the system message buffer.  This command needs to be run as root.<br>该命令用来显示linux内核的环形缓冲区(kernel ring buffer)信息,从中获得诸如系统架构、cpu、挂载的硬件，RAM等多个运行级别的大量的系统信息,当计算机启动时，系统内核（操作系统的核心部分）将会被加载到内存中,在加载的过程中会显示很多的信息，在这些信息中我们可以看到内核检测硬件设备，主要是硬件检测，包括磁盘sda,hda,usb等</p>
<p>vmstat 2 1<br>每两秒采集一次服务器的状态 2 时间间隔 1 次数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">[chenjingxiu@op ~]$ vmstat 1  3</div><div class="line">procs    -----------memory----------  ---swap-- -----io---- --system-- -----cpu-----</div><div class="line">r  b    swpd   free   buff  cache     si   so    bi    bo   in   cs us sy id wa st</div><div class="line">0  0      0 5564792 408260 20643368    0    0     0    27    1    1  1  2 97  0  0</div><div class="line">0  0      0 5562248 408260 20643372    0    0     0     0 2609 3087  1  2 98  0  0</div><div class="line">6  0      0 5530268 408260 20643380    0    0     0     0 4354 4287  4  6 90  0  0</div></pre></td></tr></table></figure></p>
<p>NAME<br>       vmstat - Report virtual memory statistics</p>
<p>SYNOPSIS<br>       vmstat [-a] [-n] [-t] [-S unit] [delay [ count ]]<br>       vmstat [-s] [-n] [-S unit]<br>       vmstat [-m] [-n] [delay [ count ]]<br>       vmstat [-d] [-n] [delay [ count ]]<br>       vmstat [-p disk partition] [-n] [delay [ count ]]<br>       vmstat [-f]<br>       vmstat [-V]</p>
<p>DESCRIPTION<br>       vmstat reports information about processes, memory, paging, block IO, traps, and cpu activity.The  first  report produced gives averages since the last reboot.  Additional reports give information on a sampling period of length delay.  The process and memory<br>                     reports are instantaneous in either case.</p>
<p>DESCRIPTION FOR VM MODE</p>
<p>Procs<br>    r: The number of processes waiting for run time.(在运行队列中等待cpu进程数)<br>    b: The number of processes in uninterruptible sleep.(等待I/O的进程数)</p>
<p>Memory<br>    swpd: the amount of virtual memory used.(切换到内存交换区的内存数量,如果swpd比较大，但是si,so一直为0，系统性能也是正常的)<br>    free: the amount of idle memory.<br>    buff: the amount of memory used as buffers.(一般对块设备的读写进行缓存)<br>    cache: the amount of memory used as cache.(page cache数量，一般作为文件系统的缓存，如果cache比较大，说明用到cache的文件比较多，如果I/O的bi比较小，说明文件系统效率比较好)<br>    inact: the amount of inactive memory. (-a option)<br>    active: the amount of active memory. (-a option)</p>
<p>Swap<br>    si: Amount of memory swapped in from disk (/s).(从磁盘交换进内存的页数量)<br>    so: Amount of memory swapped to disk (/s).(从内存交换到磁盘的页数量)</p>
<p>IO<br>    bi: Blocks received from a block device (blocks/s).(从磁盘读到内存的块数)<br>    bo: Blocks sent to a block device (blocks/s).(从内存写入磁盘的块数)</p>
<p>System<br>    in: The number of interrupts per second, including the clock.(每秒设备中断数)<br>    cs: The number of context switches per second.(每秒产生的上下文切换次数，cs正常情况下，应小于I/O的包传输速率)</p>
<p>CPU<br>    These are percentages of total CPU time.<br>    us: Time spent running non-kernel code. (user time, including nice time) (用户进程占用cpu的时间比)<br>    sy: Time spent running kernel code. (system time) (系统进程占用cpu的时间比)<br>    id: Time spent idle. Prior to Linux 2.5.41, this includes IO-wait time.(中央处理器空闲时间占用比)<br>    wa: Time spent waiting for IO. Prior to Linux 2.5.41, included in idle.<br>    st: Time stolen from a virtual machine. Prior to Linux 2.6.11, unknown.</p>
<p>FIELD DESCRIPTION FOR DISK MODE</p>
<p>Reads<br>    total: Total reads completed successfully<br>    merged: grouped reads (resulting in one I/O)<br>    sectors: Sectors read successfully<br>    ms: milliseconds spent reading</p>
<p>Writes<br>    total: Total writes completed successfully<br>    merged: grouped writes (resulting in one I/O)<br>    sectors: Sectors written successfully<br>    ms: milliseconds spent writing</p>
<p>IO<br>    cur: I/O in progress<br>    s: seconds spent for I/O<br>    ms: milliseconds spent writing</p>
<p>IO<br>    cur: I/O in progress<br>    s: seconds spent for I/O</p>
<p>FIELD DESCRIPTION FOR DISK PARTITION MODE</p>
<pre><code>reads: Total number of reads issued to this partition read sectors: Total read sectors for partition
writes : Total number of writes issued to this partition
requested writes: Total number of write requests made for partition
</code></pre><p>FIELD DESCRIPTION FOR SLAB MODE</p>
<pre><code>cache: Cache name
num: Number of currently active objects
total: Total number of available objects
size: Size of each object
pages: Number of pages with at least one active object
totpages: Total number of allocated pages
pslab: Number of pages per slab
</code></pre><p>如果r经常大于4 ，且id经常小于40，表示中央处理器的负荷很重。 如果bi，bo 长期不等于0，表示物理内存容量太小</p>
<p>mpstat -P ALL 1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div></pre></td><td class="code"><pre><div class="line">[chenjingxiu@op ~]$ mpstat -P ALL 1</div><div class="line">Linux 2.6.32-279.19.1.el6.centos.plus.x86_64 (op.liebaopay.com)         12/11/2016      _x86_64_        (8 CPU)</div><div class="line"></div><div class="line">06:49:57 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle</div><div class="line">06:49:58 AM  all    0.50    0.00    1.00    0.50    0.00    0.00    0.00    0.00   97.99</div><div class="line">06:49:58 AM    0    1.01    0.00    1.01    1.01    0.00    0.00    0.00    0.00   96.97</div><div class="line">06:49:58 AM    1    1.00    0.00    1.00    3.00    0.00    0.00    0.00    0.00   95.00</div><div class="line">06:49:58 AM    2    0.00    0.00    2.02    0.00    0.00    0.00    0.00    0.00   97.98</div><div class="line">06:49:58 AM    3    0.99    0.00    0.99    0.00    0.00    0.00    0.00    0.00   98.02</div><div class="line">06:49:58 AM    4    0.99    0.00    0.99    0.00    0.00    0.00    0.00    0.00   98.02</div><div class="line">06:49:58 AM    5    0.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00   99.00</div><div class="line">06:49:58 AM    6    0.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00   99.00</div><div class="line">06:49:58 AM    7    0.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00   99.00</div><div class="line"></div><div class="line">06:49:58 AM  CPU    %usr   %nice    %sys %iowait    %irq   %soft  %steal  %guest   %idle</div><div class="line">06:49:59 AM  all    0.50    0.00    1.51    0.00    0.00    0.00    0.00    0.00   97.99</div><div class="line">06:49:59 AM    0    2.97    0.00    5.94    0.00    0.00    0.00    0.00    0.00   91.09</div><div class="line">06:49:59 AM    1    0.00    0.00    1.02    0.00    0.00    0.00    0.00    0.00   98.98</div><div class="line">06:49:59 AM    2    0.99    0.00    1.98    0.00    0.00    0.00    0.00    0.00   97.03</div><div class="line">06:49:59 AM    3    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00</div><div class="line">06:49:59 AM    4    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00</div><div class="line">06:49:59 AM    5    0.00    0.00    1.01    0.00    0.00    0.00    0.00    0.00   98.99</div><div class="line">06:49:59 AM    6    0.00    0.00    0.00    0.00    0.00    0.00    0.00    0.00  100.00</div><div class="line">06:49:59 AM    7    0.00    0.00    1.00    0.00    0.00    0.00    0.00    0.00   99.00</div></pre></td></tr></table></figure></p>
<p>NAME<br>    mpstat - Report processors related statistics.</p>
<p>DESCRIPTION<br>    The mpstat command writes to standard output activities for each available processor, processor 0 being the first one.  Global average activities among all processors are also reported.  The mpstat command can be used both on SMP and UP machines, but in the  latter,  only  global  average  activities  will  be printed. If no activity has been selected, then the default report is the CPU utilization report.<br>    The  interval  parameter  specifies  the  amount  of time in seconds between each report.  A value of 0 (or no parameters at all) indicates that processors statistics are to be reported for the time since system startup (boot).  The count parameter can be specified in conjunction with the interval parameter if  this  one  is not set to zero. The value of count determines the number of reports generated at interval seconds apart. If the interval parameter is speci-fied without the count parameter, the mpstat command generates reports continuously.</p>
<p>OPTIONS<br>    -A     This option is equivalent to specifying -I ALL -u -P ALL<br>    -P { cpu [,…] | ON | ALL  }<br>    Indicate the processor number for which statistics are to be reported.  cpu is the processor number. Note that processor 0 is the  first  processor.The  ON keyword indicates that statistics are to be reported for every online processor, whereas the ALL keyword indicates that statistics are to be reported for all processors.<br>    -u     Report CPU utilization. The following values are displayed:</p>
<pre><code>CPU Processor number. The keyword all indicates that statistics are calculated as averages among all processors.
%usr Show the percentage of CPU utilization that occurred while executing at the user level (application).
%nice Show the percentage of CPU utilization that occurred while executing at the user level with nice priority.
%sys Show the percentage of CPU utilization that occurred while executing at the system level (kernel). Note that this does not include time spent servicing hardware and software interrupts.
%iowait Show the percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request.
%irq Show the percentage of time spent by the CPU or CPUs to service hardware interrupts.
%soft Show the percentage of time spent by the CPU or CPUs to service software interrupts.
%steal Show  the  percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual proces-sor.
%guest Show the percentage of time spent by the CPU or CPUs to run a virtual processor.
%idle Show the percentage of time that the CPU or CPUs were idle and the system did not have an outstanding disk I/O request.
</code></pre><p>ipdstat 1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div></pre></td><td class="code"><pre><div class="line">[chenjingxiu@op ~]$ pidstat 1</div><div class="line">Linux 2.6.32-279.19.1.el6.centos.plus.x86_64 (op.liebaopay.com)         12/11/2016      _x86_64_        (8 CPU)</div><div class="line"></div><div class="line">07:01:34 AM       PID    %usr %system  %guest    %CPU   CPU  Command</div><div class="line">07:01:35 AM      3294    0.00    0.84    0.00    0.84     3  python2.7</div><div class="line">07:01:35 AM     14733    0.84    0.00    0.00    0.84     0  sshd</div><div class="line">07:01:35 AM     15959    4.20   11.76    0.00   15.97     0  pidstat</div><div class="line">07:01:35 AM     30156    0.00    0.84    0.00    0.84     1  tmux</div><div class="line"></div><div class="line">07:01:35 AM       PID    %usr %system  %guest    %CPU   CPU  Command</div><div class="line">07:01:36 AM        36    0.00    1.00    0.00    1.00     1  events/1</div><div class="line">07:01:36 AM     14733    0.00    1.00    0.00    1.00     0  sshd</div><div class="line">07:01:36 AM     15959    5.00   13.00    0.00   18.00     0  pidstat</div><div class="line">07:01:36 AM     29962    1.00    0.00    0.00    1.00     0  python</div></pre></td></tr></table></figure></p>
<p>NAME<br>       pidstat - Report statistics for Linux tasks.</p>
<p>DESCRIPTION<br>The pidstat command is used for monitoring individual tasks currently being managed by the Linux kernel.  It writes to standard output activities for every task  selected with option -p or for every task managed by the Linux kernel if option -p ALL has been used. Not selecting any tasks is equivalent to speci-fying -p ALL but only active tasks (tasks with non-zero statistics values) will appear in the report.</p>
<p>The pidstat command can also be used for monitoring the child processes of selected tasks.  Read about option -T below.</p>
<p>The interval parameter specifies the amount of time in seconds between each report.  A value of 0 (or no parameters at all) indicates that tasks statistics are  to  be reported for the time since system startup (boot).  The count parameter can be specified in conjunction with the interval parameter if this one is not set to zero. The value of count determines the number of reports generated at interval seconds apart. If the interval parameter is specified without the count parameter, the pidstat command generates reports continuously.</p>
<p>You can select information about specific task activities using flags.  Not specifying any flags selects only CPU activity.</p>
<p>EXAMPLES</p>
<p>pidstat 2 5<br>    Display five reports of CPU statistics for every active task in the system at two second intervals.</p>
<p>pidstat -r -p 1643 2 5<br>    Display five reports of page faults and memory statistics for PID 1643 at two second intervals.</p>
<p>pidstat -T CHILD -r 2 5<br>    Display five reports of page faults statistics at two second intervals for the child processes of all tasks in the system. Only child processes with non-zero statistics values are displayed.</p>
<p>iostat -xz 1<br>iostat主要用于监控系统设备的IO负载情况<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div></pre></td><td class="code"><pre><div class="line">chenjingxiu:~ kivmi$ iostat -d -K 1 10</div><div class="line">disk0               disk2               disk3 </div><div class="line">KB/t  tps  MB/s     KB/t  tps  MB/s     KB/t  tps  MB/s </div><div class="line">52.04    6  0.31    14.14    0  0.00    14.03    0  0.00 </div><div class="line">4.00    9  0.04     0.00    0  0.00     0.00    0  0.00 </div><div class="line">6.67    3  0.02     0.00    0  0.00     0.00    0  0.00 </div><div class="line">4.00    1  0.00     0.00    0  0.00     0.00    0  0.00 </div><div class="line">394.00    2  0.77     0.00    0  0.00     0.00    0  0.00 </div><div class="line"></div><div class="line">[chenjingxiu@op ~]$ iostat -xz 1</div><div class="line">Linux 2.6.32-279.19.1.el6.centos.plus.x86_64 (op.liebaopay.com)         12/11/2016      _x86_64_        (8 CPU)</div><div class="line"></div><div class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</div><div class="line">1.08    0.00    1.92    0.13    0.01   96.86</div><div class="line"></div><div class="line">Device:         rrqm/s   wrqm/s     r/s     w/s   rsec/s   wsec/s avgrq-sz avgqu-sz   await  svctm  %util</div><div class="line">xvda              0.00     0.09    0.03    7.72     0.89    62.49     8.18     0.05    6.19   1.23   0.95</div><div class="line">xvdi              0.00     9.52    0.03    6.74     2.13   130.09    19.52     0.09   12.73   0.51   0.34</div><div class="line">xvdb              0.00     0.00    0.01    0.12     0.12     9.44    73.96     0.04  304.96   2.07   0.03</div><div class="line">xvdf              0.00     0.01    0.06    3.31     3.25   229.37    69.16     0.03    8.61   0.17   0.06</div><div class="line"></div><div class="line">avg-cpu:  %user   %nice %system %iowait  %steal   %idle</div><div class="line">0.38    0.00    0.75    0.25    0.13   98.50</div><div class="line"></div><div class="line">Device:         rrqm/s   wrqm/s     r/s     w/s   rsec/s   wsec/s avgrq-sz avgqu-sz   await  svctm  %util</div><div class="line">xvda              0.00     0.00    1.00    0.00    16.00     0.00    16.00     0.02   17.00  17.00   1.70</div></pre></td></tr></table></figure></p>
<p>NAME<br>    iostat - Report Central Processing Unit (CPU) statistics and input/output statistics for devices, partitions and network filesystems (NFS).</p>
<p>DESCRIPTION<br>    The  iostat  command is used for monitoring system input/output device loading by observing the time the devices are active in relation to their average transfer rates. The iostat command generates reports that can be used to change system configuration to better balance the input/output load between physical disks.</p>
<p>The first report generated by the iostat command provides statistics concerning the time since the system was booted. Each  subsequent  report  covers  the  time since  the  previous  report.  All  statistics are reported each time the iostat command is run. The report consists of a CPU header row followed by a row of CPU statistics. On multiprocessor systems, CPU statistics are calculated system-wide as averages among all processors. A device header row is displayed followed by a line  of statistics for each device that is configured.  When option -n is used, an NFS header row is displayed followed by a line of statistics for each network filesystem that is mounted.</p>
<p>The interval parameter specifies the amount of time in seconds between each report. The first report contains  statistics  for  the  time  since  system  startup (boot).  Each  subsequent report contains statistics collected during the interval since the previous report. The count parameter can be specified in conjunction with the interval parameter. If the count parameter is specified, the value of count determines the number of reports generated at interval seconds apart. If the interval parameter is specified without the count parameter, the iostat command generates reports continuously.</p>
<p>REPORTS<br>    The iostat command generates three types of reports, the CPU Utilization report, the Device Utilization report and the Network Filesystem report.</p>
<p>CPU Utilization Report<br>    The  first  report generated by the iostat command is the CPU Utilization Report. For multiprocessor systems, the CPU values are global averages among all processors.  The report has the following format:<br>%user<br>Show the percentage of CPU utilization that occurred while executing at the user level (application).</p>
<p>%nice<br>Show the percentage of CPU utilization that occurred while executing at the user level with nice priority.</p>
<p>%system<br>Show the percentage of CPU utilization that occurred while executing at the system level (kernel).</p>
<p>%iowait<br>Show the percentage of time that the CPU or CPUs were idle during which the system had an outstanding disk I/O request.</p>
<p>%steal<br>Show the percentage of time spent in involuntary wait by the virtual CPU or CPUs while the hypervisor was servicing another virtual processor.</p>
<p>%idle<br>Show the percentage of time that the CPU or CPUs were idle and the system did not have an outstanding disk I/O request.</p>
<p>Device Utilization Report<br>    The second report generated by the iostat command is the Device Utilization Report. The device report provides statistics on a per physical device or par-tition  basis.  Block  devices  for which statistics are to be displayed may be entered on the command line. Partitions may also be entered on the command line providing that option -x is not used.  If no device nor partition is entered, then statistics are displayed for every device used by the system,  and providing  that  the  kernel maintains statistics for it.  If the ALL keyword is given on the command line, then statistics are displayed for every device defined by the system, including those that have never been used.  The report may show the following fields, depending on the flags used.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div></pre></td><td class="code"><pre><div class="line">tps: 每秒传输的次数，一次传输即一次I/O请求（多个逻辑请求可以合并为一次I/O请求)</div><div class="line">kB_read/s: 每秒从设备读取的数据量</div><div class="line">kB_wrtn/s: 每秒向设备写入的数据量</div><div class="line">kB_read: 读取的总数据量</div><div class="line">kB_wrtn: 写入的总数据量</div><div class="line">rrqm/s：每秒这个设备相关的读取请求有多少被Merge了</div><div class="line">wrqm/s：每秒这个设备相关的写入请求有多少被Merge了</div><div class="line">rsec/s：每秒读取的扇区数</div><div class="line">wsec/：每秒写入的扇区数</div><div class="line">rKB/s：The number of read requests that were issued to the device per second</div><div class="line">wKB/s：The number of write requests that were issued to the device per second</div><div class="line">avgrq-sz：平均请求扇区的大小</div><div class="line">avgqu-sz：平均请求队列的长度</div><div class="line">await：每一个IO请求的处理的平均时间（单位是微秒毫秒)，即IO的响应时间,一般情况下，await大于svctm，两者差值越小，则说明队列时间越短，反之差值越大，队列时间越长,说明系统出问题了，await一般低于5ms</div><div class="line">svctm：表示平均每次设备I/O操作的服务时间（以毫秒为单位)，如果svctm的值与await很接近，表示几乎没有I/O等待，磁盘性能很好，如果await的值远高于svctm的值，则表示I/O队列等待太长，系统上运行的应用程序将变慢</div><div class="line">%util： 在统计时间内所有处理IO时间，除以总共统计时间，预示设备的繁忙程度，如果该参数是100%表示设备已经接近满负荷运行了</div></pre></td></tr></table></figure>
<p>Network Filesystem report<br>    The Network Filesystem (NFS) report provides statistics for each mounted network filesystem.  The report shows the following fields </p>
<p>OPTIONS<br>    -c     Display the CPU utilization report.<br>    -d     Display the device utilization report.(显示磁盘的使用状态)<br>    -K     对块设备，强制使用Kilobytes为单位<br>    -x     Display  extended  statistics.  This option works with post 2.5 kernels since it needs /proc/diskstats file or a mounted sysfs to get the statistics. This option may also work with older kernels (e.g. 2.4) only if extended statistics are available in /proc/partitions (the  kernel  needs  to  be  patched  for that).(显示I/O相关的扩展数据)<br>    -n     Display the network filesystem (NFS) report. This option works only with kernel 2.6.17 and later.<br>    -p [ { device [,…] | ALL  }  ]<br>        The  -p  option  displays  statistics  for block devices and all their partitions that are used by the system.  If a device name is entered on the command line, then statistics for it and all its partitions are displayed. Last, the ALL keyword indicates that statistics have to be displayed for all the  block devices and partitions defined by the system, including those that have never been used.  Note that this option works only with post 2.5 kernels.</p>
<p>EXAMPLES</p>
<pre><code>iostat
Display a single history since boot report for all CPU and Devices.
iostat -d 2
Display a continuous device report at two second intervals.
iostat -d 2 6
Display six reports at two second intervals for all devices.
iostat -x hda hdb 2 6
Display six reports of extended statistics at two second intervals for devices hda and hdb.
iostat -p sda 2 6
Display six reports at two second intervals for device sda and all its partitions (sda1, etc.)
</code></pre><p>主要看await和%util的值，await是否大于5ms，%util是否大于80%</p>
<p>free -m<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">[chenjingxiu@op ~]$ free -m </div><div class="line">total       used       free     shared    buffers     cached</div><div class="line">Mem:         30100      24655       5445          0        398      20166</div><div class="line">-/+ buffers/cache:       4089      26010</div><div class="line">Swap:            0          0          0</div></pre></td></tr></table></figure></p>
<p>NAME<br>       free - Display amount of free and used memory in the system<br>DESCRIPTION<br>       free  displays  the  total  amount  of free and used physical and swap memory in the system, as well as the buffers used by the kernel.  The shared memory column should be ignored; it is obsolete.</p>
<p>sar -n DEV 1<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">[chenjingxiu@op ~]$ sar -n DEV 1</div><div class="line">Linux 2.6.32-279.19.1.el6.centos.plus.x86_64 (op.liebaopay.com)         12/11/2016      _x86_64_        (8 CPU)</div><div class="line"></div><div class="line">07:26:36 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</div><div class="line">07:26:37 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00</div><div class="line">07:26:37 AM      eth0    150.51    152.53     29.42     21.03      0.00      0.00      0.00</div><div class="line"></div><div class="line">07:26:37 AM     IFACE   rxpck/s   txpck/s    rxkB/s    txkB/s   rxcmp/s   txcmp/s  rxmcst/s</div><div class="line">07:26:38 AM        lo      0.00      0.00      0.00      0.00      0.00      0.00      0.00</div><div class="line">07:26:38 AM      eth0    107.00    103.00     24.87     14.36      0.00      0.00      0.00</div></pre></td></tr></table></figure></p>
<p>NAME<br>       sar - Collect, report, or save system activity information.</p>
<p>DESCRIPTION<br>The  sar  command  writes to standard output the contents of selected cumulative activity counters in the operating system. The accounting system, based on the values in the count and interval parameters, writes information the specified number of times spaced at the specified intervals  in  seconds.   If  the interval  parameter is set to zero, the sar command displays the average statistics for the time since the system was started. If the interval parameter is specified without the count parameter, then reports are generated continuously.  The collected data can also be saved in the file specified by the -o file-name  flag,  in  addition  to  being  displayed  onto  the  screen.  If  filename  is  omitted,  sar uses the standard system activity daily data file, the /var/log/sa/sadd file, where the dd parameter indicates the current day.  By default all the data available from the kernel are saved in the data file.</p>
<p>The sar command extracts and writes to standard output records previously saved in a file. This file can be either the one specified by the -f flag or,  by default, the standard system activity daily data file.</p>
<p>Without the -P flag, the sar command reports system-wide (global among all processors) statistics, which are calculated as averages for values expressed as percentages, and as sums otherwise. If the -P flag is given, the sar command reports activity which relates to the specified processor or processors. If -P ALL is given, the sar command reports statistics for each individual processor and global statistics among all processors.</p>
<p>You  can  select  information  about specific system activities using flags. Not specifying any flags selects only CPU activity.  Specifying the -A flag is equivalent to specifying -bBdqrRSvwWy -I SUM -I XALL -n ALL -u ALL -P ALL.</p>
<p>The default version of the sar command (CPU utilization report) might be one of the first facilities the user runs to begin system activity  investigation,because it monitors major system resources. If CPU utilization is near 100 percent (user + nice + system), the workload sampled is CPU-bound.If  multiple samples and multiple reports are desired, it is convenient to specify an output file for the sar command.  Run the sar command as a background process. The syntax for this is:</p>
<p>sar -o datafile interval count &gt;/dev/null 2&gt;&amp;1 &amp;</p>
<pre><code>All data is captured in binary form and saved to a file (datafile).  The data can then be selectively displayed with the sar command using the  -f  option.Set the interval and count parameters to select count records at interval second intervals. If the count parameter is not set, all the records saved in the file will be selected.  Collection of data in this manner is useful to characterize system usage over a period of time and determine peak usage hours.
</code></pre><p>Indicate  the  number  of  transfers  per second that were issued to the device.  Multiple logical requests can be combined into a single I/O<br>request to the device. A transfer is of indeterminate size.</p>
<p>rd_sec/s<br>Number of sectors read from the device. The size of a sector is 512 bytes.</p>
<p>wr_sec/s<br>Number of sectors written to the device. The size of a sector is 512 bytes.</p>
<p>avgrq-sz<br>The average size (in sectors) of the requests that were issued to the device.</p>
<p>avgqu-sz<br>The average queue length of the requests that were issued to the device.</p>
<p>await<br>The average time (in milliseconds) for I/O requests issued to the device to be served. This includes the time spent by the requests in  queue<br>and the time spent servicing them.</p>
<p>svctm<br>The average service time (in milliseconds) for I/O requests that were issued to the device.</p>
<p>%util<br>Percentage  of  CPU time during which I/O requests were issued to the device (bandwidth utilization for the device). Device saturation occurs<br>when this value is close to 100%.</p>
<p> sar -n TCP,ETCP 1<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">[chenjingxiu@op ~]$  sar -n TCP,ETCP 1</div><div class="line">Linux 2.6.32-279.19.1.el6.centos.plus.x86_64 (op.liebaopay.com)         12/11/2016      _x86_64_        (8 CPU)</div><div class="line"></div><div class="line">07:38:52 AM  active/s passive/s    iseg/s    oseg/s</div><div class="line">07:38:53 AM      0.00      0.00    122.22    114.14</div><div class="line"></div><div class="line">07:38:52 AM  atmptf/s  estres/s retrans/s isegerr/s   orsts/s</div><div class="line">07:38:53 AM      0.00      0.00      0.00      0.00      0.00</div></pre></td></tr></table></figure></p>
<p>top<br> <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">top - 07:40:00 up 47 days, 23:57, 122 users,  load average: 2.01, 2.03, 2.06</div><div class="line">Tasks: 2185 total,   1 running, 2174 sleeping,   8 stopped,   2 zombie</div><div class="line">Cpu(s):  0.9%us,  2.2%sy,  0.0%ni, 96.9%id,  0.0%wa,  0.0%hi,  0.0%si,  0.0%st</div><div class="line">Mem:  30822952k total, 25263368k used,  5559584k free,   408320k buffers</div><div class="line">Swap:        0k total,        0k used,        0k free, 20652508k cached</div><div class="line"></div><div class="line">PID USER      PR  NI  VIRT  RES  SHR S %CPU %MEM    TIME+  COMMAND                                                                                                                </div><div class="line">11028 chenjing  20   0 18732 2928  972 R  3.2  0.0   0:00.48 top                                                                                                                     </div><div class="line">3294 ansible   20   0  635m  49m 2928 S  1.3  0.2 525:49.41 python2.7</div></pre></td></tr></table></figure></p>
<p>NAME<br>       top - display Linux tasks</p>
<p>a: PID  –  Process Id<br>The task’s unique process ID, which periodically wraps, though never restarting at zero.</p>
<p>b: PPID  –  Parent Process Pid<br>The process ID of a task’s parent.</p>
<p>c: RUSER  –  Real User Name<br>The real user name of the task’s owner.</p>
<p>d: UID  –  User Id<br>The effective user ID of the task’s owner.</p>
<p>e: USER  –  User Name<br>The effective user name of the task’s owner.</p>
<p>f: GROUP  –  Group Name<br>The effective group name of the task’s owner.</p>
<p>g: TTY  –  Controlling Tty<br>The  name  of  the  controlling terminal.  This is usually the device (serial port, pty, etc.) from which the process was started, and which it uses for input or output.  However, a task need not be associated with a terminal, in which case you’ll see ’?’ displayed.</p>
<p>h: PR  –  Priority<br>The priority of the task.</p>
<p>i: NI  –  Nice value<br>The nice value of the task.  A negative nice value means higher priority, whereas a positive nice value means lower priority.  Zero in this field simply means priority will not be adjusted in determining a task’s dispatchability.</p>
<p>j: P  –  Last used CPU (SMP)<br>A  number  representing  the last used processor.  In a true SMP environment this will likely change frequently since the kernel intentionally uses weak affinity.  Also, the very act of running top may break this weak affinity and cause more processes to change CPUs  more  often  (because  of  the  extra demand for cpu time).</p>
<p>k: %CPU  –  CPU usage<br>The task’s share of the elapsed CPU time since the last screen update, expressed as a percentage of total CPU time.  In a true SMP environment, if ’Irixmode’ is Off, top will operate in ’Solaris mode’ where a task’s cpu usage will be divided by the total number of CPUs.  You toggle ’Irix/Solaris’  modes with the ’I’ interactive command.<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">us 用户空间占用CPU百分比</div><div class="line">sy 内核空间占用cpu百分比</div><div class="line">ni 用户空间内改变优先级的进程占用cpu百分比</div><div class="line">id cpu空闲占用百分比</div><div class="line">wa 等待输入输出的cpu占用百分比</div><div class="line">hi 硬件cpu中断占用百分比</div><div class="line">si 软中断占用百分比</div><div class="line">st 虚拟机占用百分比</div></pre></td></tr></table></figure></p>
<p>l: TIME  –  CPU Time 进程使用cpu时间总计,单位秒<br>Total CPU time the task has used since it started.  When ’Cumulative mode’ is On, each process is listed with the cpu time that it and its dead children has used.  You toggle ’Cumulative mode’ with ’S’, which is a command-line option and an interactive command.  See the ’S’ interactive command for  addi-tional information regarding this mode.</p>
<p>m: TIME+  –  CPU Time, hundredths 进程使用cpu时间总计, 单位1/100秒<br>The same as ’TIME’, but reflecting more granularity through hundredths of a second.</p>
<p>n: %MEM  –  Memory usage (RES) 使用物理内存占用比<br>A task’s currently used share of available physical memory.</p>
<p>o: VIRT  –  Virtual Image (kb)虚拟内存使用量<br>The  total amount of virtual memory used by the task.  It includes all code, data and shared libraries plus pages that have been swapped out. (Note: you can define the STATSIZE=1 environment variable and the VIRT will be calculated from the /proc/#/state VmSize field.)</p>
<p>p: SWAP  –  Swapped size (kb) 使用虚拟内存，被换出的大小<br>Per-process swap values are now taken from /proc/#/status VmSwap field.</p>
<p>q: RES  –  Resident size (kb) 进程使用的，未被还出的物理内存大小<br>The non-swapped physical memory a task has used.<br>RES = CODE + DATA.</p>
<p>r: CODE  –  Code size (kb) 可执行的代码占用物理内存的大小<br>The amount of physical memory devoted to executable code, also known as the ’text resident set’ size or TRS.</p>
<p>s: DATA  –  Data+Stack size (kb) 可执行代码以外的部分（数据段+棧)占用物理内存的大小<br>The amount of physical memory devoted to other than executable code, also known as the ’data resident set’ size or DRS.</p>
<p>t: SHR  –  Shared Mem size (kb) 共享内存大小<br>The amount of shared memory used by a task.  It simply reflects memory that could be potentially shared with other processes.</p>
<p>u: nFLT  –  Page Fault count  页面错误次数<br>The number of major page faults that have occurred for a task.  A page fault occurs when a process attempts to read from or write to a virtual page that</p>
<p>v: nDRT  –  Dirty Pages count 最后一次写入，未被修改的的页面数<br>The number of pages that have been modified since they were last written to disk.  Dirty pages must be written to disk before the corresponding physical memory location can be used for some other virtual page.</p>
<p>w: S  –  Process Status 进程状态<br>The status of the task which can be one of:<br>    ’D’ = uninterruptible sleep()<br>    ’R’ = running<br>    ’S’ = sleeping<br>    ’T’ = traced or stopped<br>    ’Z’ = zombie(僵尸进程数)<br>Tasks shown as running should be more properly thought of as ’ready to run’  –  their task_struct is simply represented on the Linux  run-queue.   Even without a true SMP machine, you may see numerous tasks in this state depending on top’s delay interval and nice value.</p>
<p>x: Command  –  Command line or Program name 命令名<br>Display the command line used to start a task or the name of the associated program.  You toggle between command line and name with ’c’, which is both a command-line option and an interactive command.When you’ve chosen to display command lines, processes without a command line (like kernel threads) will be shown with only the program name  in  paren-theses, as in this example:<br>( mdrecoveryd  )<br>Either  form  of display is subject to potential truncation if it’s too long to fit in this field’s current width.  That width depends upon other fields selected, their order and the current screen width.<br>Note: The ’Command’ field/column is unique, in that it is not fixed-width.  When displayed, this column will be allocated all remaining screen width (up to the maximum 512 characters) to provide for the potential growth of program names into command lines.</p>
<p>y: WCHAN  –  Sleeping in Function 睡眠状态的进程系统函数名<br>Depending  on  the  availability of the kernel link map (’System.map’), this field will show the name or the address of the kernel function in which the task is currently sleeping.  Running tasks will display a dash (’-’) in this column.<br>Note: By displaying this field, top’s own working set will be increased by over 700Kb.  Your only means of reducing that overhead will be  to  stop  and restart top.</p>
<p>z: Flags  –  Task Flags 任务标志<br>This column represents the task’s current scheduling flags which are expressed in hexadecimal notation and with zeros suppressed.  These flags are offi-cially documented in <linux sched.h="">.  Less formal documentation can also be found on the ’Fields select’ and ’Order fields’ screens.</linux></p>
<p>以上均摘录自手册，供大家参考，使用!</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chanlan.github.io/2016/12/10/关于一个接口的设计/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kivmi">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Learn And Life.">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Learn And Life." src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/10/关于一个接口的设计/" itemprop="url">
                  关于一个接口的设计
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-10T22:03:36+08:00">
                2016-12-10
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>对最近的工作做一个总结和反思，最近在处理消息分片的工作，先介绍下应用的场景：<br>我们在做一个直播的产品，直播中会存在很多消息，这样就需要对消息进行处理，然后回放的时候，会用到这些存储的文件，我们目前使用的第三方的聊天室系统，需要对第三方的消息同步到我们的系统存储起来，一方面便于查询问题，因为消息内容中除了第三方的自定义的协议之外，也会涉及到我们业务数据的上报；另外一方面，不需要依赖第三方服务，对自己的数据管控。在改版之前，第三方会在直播结束，会回调我们的接口，进行消息的同步，写入异步队列，实现串行处理，之前每个直播消息，会生成独立的一个文件，放到云存储s3，由于消息文件过大，导致有些回播在下载消息文件的过程中，加载时间太慢，甚至导致客户端app直接崩溃，为此，之前有人改过一版，只是对于消息过于大的文件，进行了不处理，也就是完全的抛弃掉，回播不会存在聊天消息，这种处理太过于武断，没有从根本上解决问题</p>
<p>在处理这个问题的过程中，遇到了一些问题<br>之前的处理方式：<br>    将消息文件从redis落地，将消息文件存放于磁盘，然后用shell脚本实现同步到s3</p>
<p>方案一<br>    我没有修改既有的这种方式，甚至没有对这种方式产生任何的质疑， 于是做了如下的设计</p>
<p>1.新增接口，提供消息分片的文件列表，需要服务端存储某个视频的消息分片的文件的列表<br>2.仍然使用既有使用shell脚本同步消息文件的方案</p>
<p>这样的设计有什么问题呢？<br>1.浪费了存储空间，这些消息文件是静态的文件，生成之后就不会变，所以并不需要把消息分片文件列表存放于redis中<br>2.消息文件的同步，将消息文件存放于本地磁盘，然后使用shell脚本同步，而且同步进程使用的单进程，实践证明，这种方式并不是最好的，由于产生的文件的数量比较多，导致消费脚本处理不过来，产生消息文件的积压</p>
<p>方案二<br>1.做好对旧版本的兼容，对接口进行修改，提供消息文件的索引文件，索引文件是消息分片文件上传到s3之后的文件列表<br>2.不基于shell脚本处理，基于s3提供的sdk，完全使用同步的方式进行处理，即不将redis中的消息内容落地处理，不生成消息文件<br>3.动态生成消息分片文件的时候，同时生成消息索引文件，并同步到s3</p>
<p>索引文件：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div></pre></td><td class="code"><pre><div class="line">[</div><div class="line">&#123;</div><div class="line">  timestamp: &quot;1481188775520&quot;,</div><div class="line">  url: &quot;http://test.s3.amazonaws.com/cheetahlive/15/33/14811887487207113059/14811887487207113059_0.json&quot;</div><div class="line">&#125;</div><div class="line">&#123;</div><div class="line">  timestamp: &quot;1481188775520&quot;,</div><div class="line">  url: &quot;http://test.s3.amazonaws.com/cheetahlive/15/33/14811887487207113059/14811887487207113059_1.json&quot;</div><div class="line">&#125;</div><div class="line"></div><div class="line">...</div><div class="line"></div><div class="line">]</div></pre></td></tr></table></figure></p>
<p>这样，既解决了服务端的存储问题，不用再存储消息分片文件了，直接客户端通过接口请求，拿到消息索引文件，通过解析消息索引文件，得到所需要的消息索引文件列表，同时解决了消息文件存放于存盘，产生的消费能力跟不上导致的文件积压的问题，如果文件比较多，还可以对回调任务处理脚本使用多进程的方式，不用考虑到是否会产生多个进程同时消费一个消息文件的问题，完美支持多进程，这样设计似乎完美了吧？</p>
<p>真的完美么？</p>
<p>方案三<br>在方案二的基础上做了以下的修改<br>方案二会产生什么问题呢？<br>1.客户端要下载消息文件，需要先请求索引文件接口，下载并解析索引文件，获取消息分片文件列表，客户端同学会说，你的接口太难用了得改啊<br>2.流量问题，移动端应用，最需要考虑的问题之一，就是能省流量<br>如何更友好的处理这些问题呢？<br>1.简化接口，还是使用索引列表的方式返回，但是处理方式跟方案一不同的地方是，服务端请求索引文件，解析并通过接口返回<br>2.生成的消息文件使用gz压缩，当然这个压缩需要s3支持，开启s3的gz压缩模式，减少消息的传输</p>
<p>到此，也算是比较完美的了，不知道还没有比较好的方案来处理这个问题？希望能得到大家的交流！</p>
<p>总结：<br>1.在接口升级的过程中需要考虑到客户端新老版本的兼容性<br>2.对于同步处理还是异步处理的选择，根据特定的业务场景进行选择，考虑有没有必要使用异步处理，不是所有场景都适合使用异步处理的方式<br>3.文件存储，考虑磁盘的使用文件，目录划分<br>4.消费模型，必须需要考虑生产者和消息者之间能力匹配问题，不然会产生积压<br>5.对于数据的处理方式和存储方式，不是所有的数据都需要使用内存或者数据库存储，可以使用云存储，结合cdn技术，更好的管理静态文件<br>6.对于考虑一个方案的时候，需要做更多的可能性测试，通过测试来选取最佳方案<br>7.在思考方案的时候，需要从头到尾的考虑整个的数据的处理过程，可能是一个回路，只是变更一种数据获取方式，所以考虑的时候，尽可能的考虑每一个数据上处理的环节</p>
<p>人因为梦想而伟大，产品因为一个更好的技术方案而解放我们，多思考细节的东西，才能挖掘别人看不到的东西，一切变化，都因为在变！！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chanlan.github.io/2016/12/06/一个shell脚本/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kivmi">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Learn And Life.">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Learn And Life." src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/06/一个shell脚本/" itemprop="url">
                  一个shell脚本
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-06T18:50:32+08:00">
                2016-12-06
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>工作中有时候需要使用shell来做一些文件处理，但是在使用shell脚本之前，先确定是否使用该方案来处理，以下是我一个位上线的脚本<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div><div class="line">42</div><div class="line">43</div><div class="line">44</div><div class="line">45</div><div class="line">46</div><div class="line">47</div><div class="line">48</div><div class="line">49</div><div class="line">50</div><div class="line">51</div><div class="line">52</div><div class="line">53</div><div class="line">54</div><div class="line">55</div><div class="line">56</div><div class="line">57</div><div class="line">58</div><div class="line">59</div><div class="line">60</div><div class="line">61</div></pre></td><td class="code"><pre><div class="line">###############################</div><div class="line"># 消息进程管理                                    #</div><div class="line">#                                                        #</div><div class="line"># Author:  chenjx                               #</div><div class="line"># Since:   2016-12-05                       #</div><div class="line"># version: 1.0                                    #</div><div class="line">###############################</div><div class="line">OLD_DIR=&apos;/data/logs/message/msg/&apos;</div><div class="line">NEW_DIR=&apos;/data/logs/message/newMsg/&apos;</div><div class="line">SHELL_CMD=&apos;/bin/bash&apos;</div><div class="line">CURRENT_DIR=`pwd`</div><div class="line">SHELL_SCRIPT=&quot;$&#123;CURRENT_DIR&#125;/pushmsgtos3one.sh&quot;</div><div class="line">LOG_FILE=&apos;/data/logs/message/process_log.txt&apos;</div><div class="line">PROCESS_NUM_LIST=`ps aux|grep &apos;pushmsgtos3one.sh&apos;|awk -F &apos; &apos; &apos;&#123;if($13)&#123;print $13&#125;&#125;&apos;`</div><div class="line">DIRECTORY_SEPARATOR=&apos;/&apos;</div><div class="line"></div><div class="line">#检查进程</div><div class="line">checkNewProcess()&#123;</div><div class="line">    RET=1</div><div class="line"></div><div class="line">    if [ -d $1 -a  -x $&#123;SHELL_SCRIPT&#125; ]</div><div class="line">    then </div><div class="line">        for CHILD_DIR in `ls $1`</div><div class="line">        do </div><div class="line">            if echo &quot;$&#123;PROCESS_NUM_LIST[@]&#125;&quot; | grep -w $&#123;CHILD_DIR&#125;</div><div class="line">            then </div><div class="line">                RET=0</div><div class="line">            else </div><div class="line">                $&#123;SHELL_CMD&#125; $&#123;SHELL_SCRIPT&#125; $1$&#123;CHILD_DIR&#125;$&#123;DIRECTORY_SEPARATOR&#125;  &amp;</div><div class="line">                if [ $? -ne &apos;0&apos; ]</div><div class="line">                then </div><div class="line">                    echo  &apos;&gt; NEW:&apos; $&#123;SHELL_SCRIPT&#125; $&#123;CHILD_DIR&#125; &apos; Error&apos; &gt;&gt; $&#123;LOG_FILE&#125; </div><div class="line">                fi</div><div class="line">            fi</div><div class="line">        done  </div><div class="line">    else </div><div class="line">        echo $&#123;OLD_DIR&#125; $&#123;NEW_DIR&#125;&apos; Check  Error&apos; &gt;&gt; $&#123;LOG_FILE&#125;</div><div class="line">    fi</div><div class="line"></div><div class="line">    return $RET</div><div class="line">&#125;</div><div class="line"></div><div class="line">#兼容老版本</div><div class="line">checkOldProcess()&#123;</div><div class="line">    RET=1</div><div class="line"></div><div class="line">    if [ -d $1 -a  -x $&#123;SHELL_SCRIPT&#125; ]</div><div class="line">    then </div><div class="line">        $&#123;SHELL_CMD&#125; $&#123;SHELL_SCRIPT&#125; $1  &amp;</div><div class="line">        if [ $? -ne &apos;0&apos; ]</div><div class="line">        then </div><div class="line">            echo  &apos;&gt; OLD:&apos; $&#123;SHELL_SCRIPT&#125; $&#123;CHILD_DIR&#125; &apos; Error&apos; &gt;&gt; $&#123;LOG_FILE&#125; </div><div class="line">        fi</div><div class="line">    fi</div><div class="line"></div><div class="line">    return $RET</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">checkOldProcess $&#123;OLD_DIR&#125;</div><div class="line">checkNewProcess $&#123;NEW_DIR&#125;</div></pre></td></tr></table></figure></p>
<p>只是方案进行了修改，不使用这种方式来处理，由于需要清理分支，所以记录下来！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chanlan.github.io/2016/12/03/算法/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kivmi">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Learn And Life.">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Learn And Life." src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/12/03/算法/" itemprop="url">
                  算法
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-12-03T20:17:14+08:00">
                2016-12-03
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>1.矩阵求素数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div><div class="line">37</div><div class="line">38</div><div class="line">39</div><div class="line">40</div><div class="line">41</div></pre></td><td class="code"><pre><div class="line">#include&lt;stdio.h&gt;</div><div class="line">#include&lt;stdlib.h&gt;             </div><div class="line"></div><div class="line">void  makeMatrix(int len,int data[])&#123; </div><div class="line">    int i,j;                   </div><div class="line"></div><div class="line">    //初始化矩阵               </div><div class="line">    for(i =2;i&lt;len;i++)&#123;       </div><div class="line">        data[i] = 1;           </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    for(i =2; i&lt;len; i++)&#123;     </div><div class="line">        if(data[i])&#123;           </div><div class="line">            for(j=i; i*j &lt; len; j++)&#123;       </div><div class="line">                data[i*j] = 0; </div><div class="line">            &#125;</div><div class="line">        &#125;                      </div><div class="line">    &#125;</div><div class="line">&#125; </div><div class="line"></div><div class="line">int main(int argc, char **argv)&#123;</div><div class="line">    int N = atol(argv[1]);</div><div class="line">    int *data = malloc(N * sizeof(int));</div><div class="line"></div><div class="line">    if(data == NULL)&#123;</div><div class="line">        printf(&quot;Insufficient memory.\n&quot;);</div><div class="line">        return -1;</div><div class="line">    &#125;                                                                                                                                                                              </div><div class="line"></div><div class="line">    makeMatrix(N,data);</div><div class="line"></div><div class="line">    for(int i =2 ; i &lt; N; i++)&#123;</div><div class="line">        if(data[i])&#123;    </div><div class="line">             printf(&quot;%4d &quot;, i);              </div><div class="line">        &#125;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    printf(&quot;\n&quot;);</div><div class="line"></div><div class="line">    return 0;</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>该方法使用0和1，通过构建数组的方式，使用动态内存分配的方式，来求素数</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chanlan.github.io/2016/11/29/c语言中的宏/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kivmi">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Learn And Life.">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Learn And Life." src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/29/c语言中的宏/" itemprop="url">
                  c语言中的宏
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-29T19:37:50+08:00">
                2016-11-29
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>宏是关键字define定义，一种简单的字符串替换方式，可以分为带参数和不带参数两种。</p>
<p>1.#和##在宏中的使用<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#define ERROR_LOG(x)  fprintf(stderr,&quot;Error:&quot;#x&quot;\n&quot;);</div></pre></td></tr></table></figure></p>
<p>对参数x使用#引用，实现对参数器字符数组化预处理，如果调用ERROR_LOG(“error log”)，则输出Error:“error log“<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#define TYPE(type,name)   type name_##type##_type</div></pre></td></tr></table></figure></p>
<p>使用##，预处理器实现字符串之间分隔连接方式，如果调用TYPE(int,”user”)， 则预处理之后int name_int_type，这样实现了变量的类型定义<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">#define NUMBERS 1,2,3</div><div class="line">int x[] = &#123; NUMBERS &#125;;</div></pre></td></tr></table></figure></p>
<p>可以使用这种方式来实现创建一个数组</p>
<p>2.do…while<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">#define PRINT(x)  \</div><div class="line">    do&#123;         \</div><div class="line">       printf(&quot;print x\n&quot;); \</div><div class="line">    &#125;while(0)</div></pre></td></tr></table></figure></p>
<p>使用do…while…来包裹，实现语言结构的独立</p>
<p>3.函数宏<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#define lang_init()  c_init()</div></pre></td></tr></table></figure></p>
<p>调用lang_init()，实现c_init()函数的调用</p>
<p>4.宏参数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">#define min(X, Y)  ((X) &lt; (Y) ? (X) : (Y))</div></pre></td></tr></table></figure></p>
<p>调用x = min(a, b);实际上是x = ((a) &lt; (b) ? (a) : (b)); 执行</p>
<p>5.预定义宏<br><strong>COUNTER</strong>，<strong>GFORTRAN</strong>，<strong>GNUC</strong>，<strong>GNUC_MINOR</strong>，<strong>GNUC_PATCHLEVEL</strong>，<strong>GNUG</strong>，<strong>STRICT_ANSI</strong>，<strong>VERSION</strong>，<strong>NO_INLINE</strong>，<strong>GNUC_GNU_INLINE</strong>，<strong>OPTIMIZE</strong><br>等等</p>
<p>6.#ifdef …. #else …. #if … #endif</p>
<p>7.PHP中常见的宏<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line"># define CG(v) TSRMG(compiler_globals_id, zend_compiler_globals *, v)</div><div class="line"># define EG(v) TSRMG(executor_globals_id, zend_executor_globals *, v)</div><div class="line"># define PG(v) TSRMG(core_globals_id, php_core_globals *, v)</div><div class="line"># define SG(v) TSRMG(sapi_globals_id, sapi_globals_struct *, v)</div><div class="line"># define PG(v) TSRMG(core_globals_id, php_core_globals *, v)</div><div class="line"># define TSRM_UNSHUFFLE_RSRC_ID(rsrc_id) ((rsrc_id)-1)</div><div class="line"># define TSRMG(id, type, element) (((type) (*((void ***) tsrm_ls))[TSRM_UNSHUFFLE_RSRC_ID(id)])-&gt;element)</div></pre></td></tr></table></figure></p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chanlan.github.io/2016/11/25/C指针/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kivmi">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Learn And Life.">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Learn And Life." src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/25/C指针/" itemprop="url">
                  C指针
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-25T20:34:32+08:00">
                2016-11-25
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>说起指针，不得不提下数组，因为两者在某些方面有相似之处，请看下面的代码：<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">extern int *x;</div><div class="line">extern int y[];</div></pre></td></tr></table></figure></p>
<p>数组在什么时候等同于指针呢？什么时候又不等同于指针呢？</p>
<p>1.数组和指针的访问方式<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">char  a[9] = &quot;abcdefgh&quot;;</div><div class="line">char  *p = &quot;abcdefgh&quot;;</div></pre></td></tr></table></figure></p>
<p>编译器编译的时候会生成一个符号表，这样a和p都在这个符号表里，每一个符号表，都有一个符号跟地址的对应关系，如下：<br>a–&gt;9980<br>p–&gt;4624</p>
<p>a–&gt;9980–&gt;+1–&gt;+2–+3–&gt;…-&gt;+i–&gt;–&gt;<br>编译器符号表地址9980<br>取i的值，将它与9980相加<br>取地址(9980+i)的内容</p>
<p>p–&gt;4624–&gt;5081–&gt;data<br>编译器符号表地址 4624<br>取地址4624的内容，即5081<br>取地址5081的内容<br>也就是说，对于a而言，符号表的地址，即为数组a地址，然而对于p而言，符号表对应的地址，对应的是一个4字节的对象指针，而其内容存放的是一个地址，这个地址存储的数据即为指针所对应的数据。</p>
<p>2.使用指针来访问数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">char *p=&quot;abcdefgh&quot;;</div><div class="line">c = p[i];</div></pre></td></tr></table></figure></p>
<p>p–&gt;4624–&gt;5081  —|(5081+i)| —5081–&gt;+1–&gt;+2–&gt;+3–&gt;…–&gt;+i–&gt;–&gt;<br>编译器符号表的p地址4624，提取存储于此处的指针5801<br>取下标偏移量，将其与指针的值相加，产生一个地址<br>访问这个地址，取得子符<br>同样也能访问到数组的内容d,只是访问的方式略有不同，首先进行间接引用，然后按照下标偏移量直接访问。</p>
<p>3.指针所引用的数据，其地址可以是不连续的，而数组，其地址是连续的，指针使用malloc()和 free()来管理内存,且只有字符串才可以初始化指针,其它类型均不可以直接赋值,且初始化之后，是只读的，不可以修改其值 .</p>
<p>4.数组和指针，有且只有作为函数的参数的时候，才是等同的<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">printf(&quot;array at location %x holds string %s&quot;, a, a);</div></pre></td></tr></table></figure></p>
<p>这里数组既作为指针使用，也可以作为字符数组使用，只是因为printf是函数，参数中的数组和指针等同<br>又比如main函数<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">int main(char **argv,int argc);</div><div class="line">int main(char *argv[], int argc);</div></pre></td></tr></table></figure></p>
<p>是等同的.</p>
<p>5.应用<br>a. 二维数组<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">pea[i][j]</div><div class="line">*(*(pea+i)+j)</div></pre></td></tr></table></figure></p>
<p>等同，数组中单个元素的存储和引用实际上是以线性形式排列的内存重的，即以第一维作为组，第二位作为每个元素在组内的偏移量，这样线性排列.<br>b.函数指针<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">int (*paf())[20]&#123;</div><div class="line">    int (*pear)[20];</div><div class="line">    pear = calloc(20, sizeof(int));</div><div class="line">    if(!pear) longjmp(error,1);</div><div class="line">    return pear;</div><div class="line">&#125;</div><div class="line">int (result)[20];</div><div class="line">result = paf();</div></pre></td></tr></table></figure></p>
<p>c.Iliffe向量，即将一个二维数组，创建一个一维数组，数组中的元素是指向其它东西的指针<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">my_function(char **my_array);</div></pre></td></tr></table></figure></p>
<p>my_array是一个二维数组，一个指向向量的指针数组</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chanlan.github.io/2016/11/20/php闭包/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kivmi">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Learn And Life.">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Learn And Life." src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/20/php闭包/" itemprop="url">
                  PHP闭包
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-20T14:40:00+08:00">
                2016-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>先看看什么是闭包，闭包也就是所谓的匿名函数，只是函数的一种隐式定义，从结构化的角度可以理解为，有且只有一次调用。匿名函数并不是一个函数，而是Closure类的一个对象，Closure类是一个final类，不可以继承，同时也不可以被实例化，那么如何通过声明一个匿名函数就实现了Closure类的实例化了呢？<br>以下是php的源码中的部分代码:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">ZEND_VM_HANDLER(153, ZEND_DECLARE_LAMBDA_FUNCTION, CONST, UNUSED)</div><div class="line">&#123;</div><div class="line">    ...</div><div class="line">    if (UNEXPECTED((op_array-&gt;common.fn_flags &amp; ZEND_ACC_STATIC) || </div><div class="line">                (EX(prev_execute_data) &amp;&amp;</div><div class="line">                 EX(prev_execute_data)-&gt;function_state.function-&gt;common.fn_flags &amp; ZEND_ACC_STATIC))) &#123;</div><div class="line">        zend_create_closure(&amp;EX_T(opline-&gt;result.var).tmp_var, (zend_function *) op_array,  EG(called_scope), NULL TSRMLS_CC);</div><div class="line">     &#125; else &#123; </div><div class="line">        zend_create_closure(&amp;EX_T(opline-&gt;result.var).tmp_var, (zend_function *) op_array,  EG(scope), EG(This) TSRMLS_CC);</div><div class="line">     &#125;</div><div class="line">     ...</div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>还是看看闭包怎么用吧！先声明，后调用。先看闭包的几种使用场景。<br>场景一： 简单函数,分为使用use和不使用use<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div></pre></td><td class="code"><pre><div class="line">$outer = &quot;welcome.....&quot;;</div><div class="line">$colsure = function($inner,$outer) use ($outer)&#123;</div><div class="line">   ...... </div><div class="line">&#125;</div></pre></td></tr></table></figure></p>
<p>由此可见，加use和不加use的区别，就是use能处理外部输入的参数，而function后面的括号，能处理内部参数(实现递归)和接受外部输入的参数</p>
<p>场景二:  实现回调<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div></pre></td><td class="code"><pre><div class="line">function extractParam($func=&apos;&apos;)</div><div class="line">&#123;</div><div class="line">    if(empty($func))&#123;</div><div class="line">        return;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    return $func();</div><div class="line">&#125;</div><div class="line"></div><div class="line">extractParam(function($param)&#123;      </div><div class="line">    return $param; </div><div class="line">&#125;);</div></pre></td></tr></table></figure></p>
<p>场景三： 实现类的注册<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div><div class="line">19</div><div class="line">20</div><div class="line">21</div><div class="line">22</div><div class="line">23</div><div class="line">24</div><div class="line">25</div><div class="line">26</div><div class="line">27</div><div class="line">28</div><div class="line">29</div><div class="line">30</div><div class="line">31</div><div class="line">32</div><div class="line">33</div><div class="line">34</div><div class="line">35</div><div class="line">36</div></pre></td><td class="code"><pre><div class="line">class Binder</div><div class="line">&#123;</div><div class="line">    protected $_binders = [];</div><div class="line">    public function getClosure($abstract, $concrete)</div><div class="line">    &#123;</div><div class="line">        return function ($container, $parameters = []) use ($abstract, $concrete)&#123;</div><div class="line">            $method = ($abstract == $concrete) ? &apos;build&apos; : &apos;make&apos;;</div><div class="line">            return $container-&gt;$method($concrete, $parameters);</div><div class="line">        &#125;;</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public function build($abstract,$concrete)</div><div class="line">    &#123;</div><div class="line">        $this-&gt;_binders[$abstract] = $concrete; </div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public function make($abstract)</div><div class="line">    &#123;</div><div class="line">        .......</div><div class="line">    &#125;</div><div class="line"></div><div class="line">    public function getBinders()</div><div class="line">    &#123;</div><div class="line">        return $this-&gt;_binders; </div><div class="line">    &#125;</div><div class="line">&#125;</div><div class="line"></div><div class="line">class Bind</div><div class="line">&#123;</div><div class="line">   .......</div><div class="line">&#125;</div><div class="line"></div><div class="line"></div><div class="line">$binder = new Binder();</div><div class="line">$regitser = $binder-&gt;getClosure($abstract, $concrete);</div><div class="line">$regitser(new $binder-&gt;getBinders())</div></pre></td></tr></table></figure></p>
<p>闭包的使用，可以使代码更加的紧凑，耦合性更低，使对代码的结构看起来更加的美观，至于性能问题，是php内核实现的，预编译的时候生成，所以可以不用担心！</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
      

  

  
  
  

  <article class="post post-type-normal " itemscope itemtype="http://schema.org/Article">
  <link itemprop="mainEntityOfPage" href="http://chanlan.github.io/2016/11/20/爱情/">

  <span style="display:none" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <meta itemprop="name" content="Kivmi">
    <meta itemprop="description" content="">
    <meta itemprop="image" content="/images/avatar.gif">
  </span>

  <span style="display:none" itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
    <meta itemprop="name" content="Learn And Life.">
    <span style="display:none" itemprop="logo" itemscope itemtype="http://schema.org/ImageObject">
      <img style="display:none;" itemprop="url image" alt="Learn And Life." src="">
    </span>
  </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
            
            
              
                
                <a class="post-title-link" href="/2016/11/20/爱情/" itemprop="url">
                  爱情
                </a>
              
            
          </h1>
        

        <div class="post-meta">
          <span class="post-time">
            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              <span class="post-meta-item-text">Posted on</span>
              <time title="Post created" itemprop="dateCreated datePublished" datetime="2016-11-20T03:19:21+08:00">
                2016-11-20
              </time>
            

            

            
          </span>

          

          
            
          

          

          
          

          

          

        </div>
      </header>
    


    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p>“酷暑已至，<br>常去旁边的冶金学院游泳，<br>嗮的都成黑炭头，<br>时时想起我那掏碳的男人，<br>这想念像甘甜的美酒一样，<br>令人沉醉，<br>爱情是对我是初见端倪，<br>但已使我一洗尘泥，<br>飘飘欲仙了，<br>我放纵我的天性，<br>相信爱情能给予人创造的力量，<br>我为我的掏碳丈夫感到骄傲，<br>是的，<br>真正的爱情，<br>不应该是利己的，<br>而应该是利他的，<br>是心甘情愿的与爱人一起奋斗，<br>并不断的自我更新的过程，<br>是融合在一起，<br>完全融合在一起的共同斗争，<br>你有没有决心为他而付出自己最大的牺牲，<br>这是衡量是不是正真爱情的标准，<br>否则，<br>就是被自己的感情所欺骗”<br>                —-平凡的世界—-</p>
<p>很羡慕这样的爱情，朴素，充满了力量，给予我的感动都是满满的，有时候也很期盼那种简单而又真实的情感，也想跟我的爱人，有个约定，等待着那天的到来，在我的生命中，要是有田晓霞似的女友，有贺秀莲似的妻子，那该是人生多么幸福的一件事呢？</p>

          
        
      
    </div>

    <div>
      
    </div>

    <div>
      
    </div>


    <footer class="post-footer">
      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </article>


    
  </section>

  
  <nav class="pagination">
    <a class="extend prev" rel="prev" href="/"><i class="fa fa-angle-left"></i></a><a class="page-number" href="/">1</a><span class="page-number current">2</span>
  </nav>



          </div>
          


          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <section class="site-overview sidebar-panel sidebar-panel-active">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
          <img class="site-author-image" itemprop="image"
               src="/images/avatar.gif"
               alt="Kivmi" />
          <p class="site-author-name" itemprop="name">Kivmi</p>
          <p class="site-description motion-element" itemprop="description">代码也是有灵魂的</p>
        </div>
        <nav class="site-state motion-element">
          <div class="site-state-item site-state-posts">
            <a href="/archives">
              <span class="site-state-item-count">20</span>
              <span class="site-state-item-name">posts</span>
            </a>
          </div>

          

          
            <div class="site-state-item site-state-tags">
              <a href="/tags">
                <span class="site-state-item-count">2</span>
                <span class="site-state-item-name">tags</span>
              </a>
            </div>
          

        </nav>

        

        <div class="links-of-author motion-element">
          
        </div>

        
        

        
        

        


      </section>

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright" >
  
  &copy; 
  <span itemprop="copyrightYear">2017</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Kivmi</span>
</div>


<div class="powered-by">
  Powered by <a class="theme-link" href="https://hexo.io">Hexo</a>
</div>

<div class="theme-info">
  Theme -
  <a class="theme-link" href="https://github.com/iissnan/hexo-theme-next">
    NexT.Muse
  </a>
</div>


        

        
      </div>
    </footer>

    <div class="back-to-top">
      <i class="fa fa-arrow-up"></i>
    </div>
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>









  



  
  <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>

  
  <script type="text/javascript" src="/lib/fastclick/lib/fastclick.min.js?v=1.0.6"></script>

  
  <script type="text/javascript" src="/lib/jquery_lazyload/jquery.lazyload.js?v=1.9.7"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>

  
  <script type="text/javascript" src="/lib/fancybox/source/jquery.fancybox.pack.js?v=2.1.5"></script>


  


  <script type="text/javascript" src="/js/src/utils.js?v=5.1.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=5.1.0"></script>



  
  

  

  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=5.1.0"></script>



  



  




	




  
  

  

  

  

  


</body>
</html>
